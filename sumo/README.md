# SUMO

SUMO is an application that generates statistical data on patients, designed to work with the PIANO API. It works like any other PIANO application (such as PICCOLO etc) by making HTTP REST calls to the remote PIANO API. Most statistic calculations utilise the Python Numpy package. 

SUMO is written is a standalone Python package so it should be able to be included in any deployment scenario supporting Python. There are connecting REST endpoints available as a Python Flask application by default, but this is easily customizable. 

---

## Basic Usage 

Once this package is installed, from the python command line, import the Sumo model. 

``> from sumo import Sumo``

Create a SUMO object by specifying the `project_id`, `cohorts` and field of analysis `foa` 

``sumo = Sumo(project_id='test_rondo_integration, cohorts='A,B', foa='Person.day_of_birth')``

Cohorts can be a Python list of strings or a string seperated by commas. A maximum of two cohorts can be specified. SUMO will use these labels to analyse the `Crucible` database for patients with these cohort labels which would have been typically assigned previously in the workflow. For example, the above SUMO model will include patients who have have been labeled as in either Cohort 'A' or Cohort 'B'. 

The field of analysis is an OMOP table field specified by a dot separated table, field name pair, ie. `Tablename.fieldname`

Statistics are generated by running the `analyse` method on the sumo model

``sumo.analyse()``

The SUMO statistics can be accessed via the `stats` property

``sumo.stats``

This will contain a dictionary of basic statistical information by Cohort, such as mean, median, odds ratio and standard deviation. 

Usage examples can be found in the package [test.py](test/test.py) file

---

## Matched Pairs

If there are two Cohorts specified, SUMO will automatically generate statistic information on matched paired patients. Patients must have already been paired with a matching `pair_id` field in the `Crubicle` database, typically allocated in a previous stage of a workflow. 

---

## Odds Ratio

SUMO will try to calculate an odds ratio based on the field of analysis `foa` and `exposure_level` fields. 

``sumo = Sumo(project_id='test_rondo_integration, cohorts='A,B', foa='Person.day_of_birth', exposure_level=20)``

``sumo.analyse()``

The calculation will depend on the type of the field detected. 

If the field of analysis `foa` is numerical, the following strategy is used: 
If an `exposure_level` is specified, any field value at or above the exposure level is considered an exposure with regards to the odds ratio. If no `exposure_level` is specified, any value above zero is considered an exposure. 

If the field of analysis `foa` is nominal, any field value equal to the `exposure_level` is considered an exposure. 

---

## Distributions

If the field of analysis is numeric, SUMO will automatically calculate category counts based on the SUMO ``category_levels`` fields. Multiple category levels can be seperated by commas or specified by a Python list. 

``sumo = Sumo(project_id='test_rondo_integration, cohorts='A,B', foa='Person.day_of_birth', category_levels='15,20,25')``

``sumo.analyse()``

After `analyse` is run, sumo will contain a Python dictionary of the distribution via the SUMO `distrubution` property. 

``sumo.distribution``

---

## HTTP REST endpoints


### Creating / updating SUMO objects

SUMO objects are created and updated on the same endpoint, ie a ``POST`` to
``/projects/<project_id>/sumos``. 

If an ``_id`` is present in the posted data, the corresponding SUMO
object is updated, returning the updated object itself, otherwise a new record is created and returned. 

### Retrieving SUMO objects

All SUMO objects can be retrieved via a GET request 

``/projects/<project_id>/sumos``

Individual sumo objects can be obtained via 

``GET /projects/<project_id>/sumos/<sumo_id>``

### Retrieving SUMO statistics

SUMO statistics can be obtained via 

``GET /projects/<project_id>/sumos/<sumo_id>/stats``

This will return statistics already calculated and not perform any statistical processing. 

To refresh the statistics, use

``GET /projects/<project_id>/sumos/<sumo_id>/calc_stats``

---

## Web interface

A javascript application can be found at the relative path 
``/static/index.html``

A list of all SUMO objects can be seen from the SUMO link.

Individual SUMO objects can be viewed and updated from 

``/static/index.html#/sumos/<project_id>/<sumo_id>`` or navigated from the above SUMO list. 





